steps:
  - task: Gulp@0
    displayName: gulp release
    inputs:
      targets: release
      arguments: "--nightly --no-yarn"
  - task: CopyFiles@2
    displayName: "Copy Files to: $(Build.ArtifactStagingDirectory)"
    inputs:
      Contents: |
        $(System.DefaultWorkingDirectory)/*.vsix
      TargetFolder: "$(System.DefaultWorkingDirectory)/test/smoke/resources/extension"
  - bash: npm run prepare-smoke-tests
    displayName: "Prepare smoke tests"
  - bash: npm run smoke-tests --verbose
    displayName: "Run smoke tests"
    env:
      DISPLAY: ":99.0"
  - task: PublishBuildArtifacts@1
    displayName: "Publish screenshots"
    inputs:
      PathtoPublish: "$(System.DefaultWorkingDirectory)/test/smoke/screenshots"
      ArtifactName: 'smoke-test-screenshots'
      publishLocation: 'Container'
